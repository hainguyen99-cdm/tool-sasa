var _=(e=>(e.Local="local",e.Sync="sync",e.Managed="managed",e.Session="session",e))(_||{}),f=(e=>(e.ExtensionPagesOnly="TRUSTED_CONTEXTS",e.ExtensionPagesAndContentScripts="TRUSTED_AND_UNTRUSTED_CONTEXTS",e))(f||{});async function l(e,o){function s(r){return typeof r=="function"}function n(r){return r instanceof Promise}return s(e)?n(e)?await e(o):e(o):e}let S=!1;function h(e){if(chrome.storage[e]===void 0)throw new Error(`Check your storage permission in manifest.json: ${e} is not defined`)}function w(e,o,s){let n=null,r=[];const a=(s==null?void 0:s.storageType)??"local",m=(s==null?void 0:s.liveUpdate)??!1;S===!1&&a==="session"&&(s==null?void 0:s.sessionAccessForContentScripts)===!0&&(h(a),chrome.storage[a].setAccessLevel({accessLevel:"TRUSTED_AND_UNTRUSTED_CONTEXTS"}),S=!0);const u=async()=>(h(a),(await chrome.storage[a].get([e]))[e]??o),c=()=>{r.forEach(t=>t())},T=async t=>{n=await l(t,n),await chrome.storage[a].set({[e]:n}),c()},d=t=>(r=[...r,t],()=>{r=r.filter(i=>i!==t)}),E=()=>n;u().then(t=>{n=t,c()});async function C(t){if(t[e]===void 0)return;const i=t[e].newValue;n!==i&&(n=await l(i,n),c())}return m&&chrome.storage[a].onChanged.addListener(C),{get:u,set:T,getSnapshot:E,subscribe:d}}export{f as S,_ as a,w as c};
